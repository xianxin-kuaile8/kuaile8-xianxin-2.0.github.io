<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>号码组数据匹配工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="src/styles/styles.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            primary: '#1e1e2e',
                            secondary: '#29293a',
                            accent: '#313244',
                            surface: '#181825'
                        },
                        neon: {
                            red: '#d32f2f',
                            green: '#a6e3a1',
                            blue: '#89b4fa'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <!-- 测试DataManager初始化的脚本 -->
    <script src="test-datamanager.js" defer></script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
        }
        
        /* 替换@apply规则为标准CSS */
        .number-ball {
            width: 3rem;
            height: 3rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            transition: all 0.2s ease;
            cursor: pointer;
            background-color: #313244;
            color: #d1d5db;
        }
        .number-ball:hover {
            background-color: #29293a;
        }
        .number-ball.selected {
            background-color: #f38ba8;
            color: white;
            box-shadow: 0 0 10px rgba(243, 139, 168, 0.5);
        }
        .btn-primary {
            padding: 0.5rem 1rem;
            background-color: #89b4fa;
            color: #1e1e2e;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            background-color: rgba(137, 180, 250, 0.8);
        }
        .btn-secondary {
            padding: 0.5rem 1rem;
            background-color: #29293a;
            color: #d1d5db;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-secondary:hover {
            background-color: #313244;
        }
        .btn-danger {
            padding: 0.5rem 1rem;
            background-color: #d32f2f;
            color: white;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-danger:hover {
            background-color: rgba(211, 47, 47, 0.8);
        }
        /* 号码选择器容器 - 10行8列布局 */
        #number-selector {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.75rem;
            justify-items: center;
            margin: 1rem 0;
        }
        .card {
            background-color: #29293a;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .input-dark {
            background-color: #313244;
            border: 1px solid #374151;
            color: #e5e7eb;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            outline: none;
        }
        .input-dark:focus {
            box-shadow: 0 0 0 2px rgba(137, 180, 250, 0.5);
        }
    </style>
    <style>
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #313244;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
        /* 侧边可滑动容器 */
        .scroll-container {
            position: relative;
            overflow-x: auto;
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: thin;
        }
        .min-w-max {
            min-width: 100%;
        }
        ::-webkit-scrollbar-thumb {
            background: #45475a;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #585b70;
        }
        
        /* 号码球动画 */
        .number-ball {
            transition: all 0.2s ease;
        }
        .number-ball:hover {
            transform: scale(1.1);
        }
        .number-ball.selected {
            background-color: #d32f2f !important;
            color: white !important;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(211, 47, 47, 0.5);
        }
        
        /* Toast动画 */
        #toast {
            transition: all 0.3s ease;
        }
        
        /* 按钮悬停效果 */
        button:hover {
            transition: all 0.2s ease;
        }
        
        /* 刷新按钮旋转动画 */
        .fa-spin-hover:hover {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* 增强刷新按钮的视觉效果 */
        #refresh-data {
            border: 2px solid rgba(211, 47, 47, 0.3);
        }
        
        #refresh-data:hover {
            box-shadow: 0 0 15px rgba(211, 47, 47, 0.6);
        }
        
        /* 手机端刷新按钮样式 */
        #refresh-data-mobile {
            border: 2px solid rgba(211, 47, 47, 0.3);
            transition: all 0.2s ease;
        }
        
        #refresh-data-mobile:hover {
            transform: scale(1.05);
        }
        
        /* 点击动画效果 - 点击时变红，然后恢复 */
        #refresh-data-mobile:active {
            background-color: #b71c1c;
            box-shadow: 0 0 15px rgba(211, 47, 47, 0.8);
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-dark-surface text-gray-200 min-h-screen flex flex-col">
    <!-- 主内容区域，占据剩余空间 -->
    <div class="flex-1 pb-20">
        <!-- 界面容器 -->
        <!-- 1. 大底筛选界面 -->
        <div id="screen-filter" class="container mx-auto px-4 py-8 max-w-7xl">
            <header class="mb-8">
                <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-neon-blue to-neon-red">
                    闲心快乐8工具2.0
                </h1>
                <p class="text-center text-gray-400 mt-2">大底筛选与匹配</p>
            </header>

            <!-- 最新录入号码组显示区域 -->
            <section id="latest-number-groups" class="mb-8">
                <div class="mb-4">
                    <!-- 桌面端布局 -->
                    <div class="hidden md:flex justify-between items-center mb-2">
                        <div class="flex items-center gap-3">
                            <h2 class="text-xl font-bold flex items-center">
                                <i class="fa fa-history mr-2 text-neon-blue"></i>
                                最新录入号码组
                            </h2>
                            <button id="refresh-data" class="btn-primary bg-neon-red hover:bg-red-600 flex items-center transition-all duration-300 transform hover:scale-105 shadow-lg">
                                <i class="fa fa-refresh mr-2 fa-spin-hover"></i>刷新数据
                            </button>
                            <p class="text-xs text-gray-400">点击刷新开奖号码</p>
                        </div>
                        <div class="text-gray-400">
                            已存储: <span id="data-count-latest">0</span> 个号码组
                        </div>
                    </div>
                    
                    <!-- 手机端布局 -->
                    <div class="md:hidden">
                        <div class="flex justify-between items-center mb-2">
                            <h2 class="text-xl font-bold flex items-center">
                                <i class="fa fa-history mr-2 text-neon-blue"></i>
                                最新录入号码组
                            </h2>
                            <div class="text-gray-400">
                                已存储: <span id="data-count-latest-mobile">0</span> 个号码组
                            </div>
                        </div>
                        <div class="flex items-center gap-2 mb-1">
                            <button id="refresh-data-mobile" class="btn-primary bg-neon-red flex items-center transition-all duration-300 transform hover:scale-105">
                                <i class="fa fa-refresh mr-2 fa-spin-hover"></i>刷新数据
                            </button>
                            <p class="text-xs text-gray-400">点击刷新开奖号码</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div id="latest-groups-container" class="space-y-4">
                        <p class="text-gray-400 text-center py-6">暂无录入的号码组</p>
                    </div>
                </div>
            </section>

            <!-- 大底筛选功能 -->
            <section id="number-filter" class="mb-8">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fa fa-filter mr-2 text-neon-blue"></i>
                    大底筛选
                </h2>
                <div class="card">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-gray-300"><span id="selected-count">0</span>/25 已选择</p>
                        <div class="flex items-center gap-2">
                            <div class="filter-period-buttons flex mr-2">
                                <button id="filter-all" class="btn-secondary filter-btn active mr-1">全部期数</button>
                                <button id="filter-100" class="btn-secondary filter-btn mr-1">100期以内</button>
                                <button id="filter-200" class="btn-secondary filter-btn mr-1">200期以内</button>
                                <button id="filter-300" class="btn-secondary filter-btn">300期以内</button>
                            </div>
                            <button id="clear-selection" class="btn-danger flex items-center">
                                <i class="fa fa-times mr-2"></i>一键清除
                            </button>
                        </div>
                    </div>
                    
                    <!-- 号码选择器 -->
                    <div id="number-selector" class="grid grid-cols-8 gap-3 mb-6">
                        <!-- 1-80号码将通过JS动态生成 -->
                    </div>
                    
                    <!-- 匹配选项按钮组 - 调整为两行布局 -->
                    <div class="grid grid-cols-4 gap-2 mb-4">
                        <button class="match-btn btn-secondary py-3 px-4 text-base" data-match="2">选二</button>
                        <button class="match-btn btn-secondary py-3 px-4 text-base" data-match="3">选三</button>
                        <button class="match-btn btn-secondary py-3 px-4 text-base" data-match="4">选四</button>
                        <button class="match-btn btn-secondary py-3 px-4 text-base" data-match="5">选五</button>
                        <button class="match-btn btn-secondary py-3 px-4 text-base" data-match="6">选六</button>
                        <button class="match-btn btn-secondary py-3 px-4 text-base" data-match="7">选七</button>
                        <button class="match-btn btn-secondary py-3 px-4 text-base" data-match="8">选八</button>
                        <button class="match-btn btn-secondary py-3 px-4 text-base" data-match="9">选九</button>
                    </div>
                    <style>
                        /* 默认移动端布局：两行各4个按钮 */
                        @media screen and (min-width: 768px) {
                            /* 电脑端布局：一行9个按钮 */
                            .grid-cols-4 {
                                grid-template-columns: repeat(9, 1fr);
                            }
                        }
                        
                        /* 缩小匹配结果表格内容 */
                        #results-container table {
                            font-size: 10px !important;
                        }
                        #results-container th,
                        #results-container td {
                            padding: 2px !important;
                        }
                        /* 缩小匹配结果中的号码球 */
                        #results-container .number-ball {
                            width: 16px !important;
                            height: 16px !important;
                            font-size: 7px !important;
                        }
                        
                        .match-btn.active {
                            background-color: #d32f2f;
                            color: white;
                        }
                        .match-btn.active:hover {
                            background-color: rgba(211, 47, 47, 0.8);
                        }
                    </style>
                </div>
            </section>

            <!-- 大底组合结果 -->
            <section id="match-results" class="mb-8">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fa fa-bar-chart mr-2 text-neon-blue"></i>
                    大底组合结果
                </h2>
                <div class="card">
                    <!-- 固定的统计信息区域 -->
                    <div id="statistics-container" class="p-4 border-b border-gray-700">
                        <p class="text-gray-400 text-center py-2">请先选择号码并点击匹配按钮</p>
                    </div>
                    
                    <!-- 可滚动的匹配结果区域 -->
                    <div class="results-scroll-container overflow-y-auto overflow-x-auto" style="max-height: 300px;">
                        <div id="results-container" class="space-y-4 min-w-max p-4">
                            <!-- 匹配结果表格将在这里渲染 -->
                        </div>
                    </div>
                    
                    <!-- 固定的复制按钮区域 -->
                    <div id="copy-buttons-container" class="p-4 border-t border-gray-700 flex justify-center space-x-3">
                        <!-- 复制按钮将在这里渲染 -->
                    </div>
                    <style>
                        .results-scroll-container {
                            scrollbar-width: thin;
                            scrollbar-color: #45475a #313244;
                        }
                        .results-scroll-container::-webkit-scrollbar {
                            width: 8px;
                            height: 8px;
                        }
                        .results-scroll-container::-webkit-scrollbar-track {
                            background: #313244;
                        }
                        .results-scroll-container::-webkit-scrollbar-thumb {
                            background: #45475a;
                            border-radius: 4px;
                        }
                        .results-scroll-container::-webkit-scrollbar-thumb:hover {
                            background: #585b70;
                        }
                    </style>
                </div>
            </section>

            <!-- 数据分析功能预留 -->
            <section class="mb-8">
                <div class="card p-6">
                    <h2 class="text-xl font-bold mb-4 text-center">数据分析工具</h2>
                    <p class="text-gray-400 text-center">更多数据分析功能正在开发中...</p>
                </div>
            </section>



            <footer class="text-center text-gray-500 text-sm mt-12">
                <p>© 2025 号码组数据匹配工具 | 高效、精准的数据管理解决方案</p>
            </footer>
        </div>

        <!-- 2. 概率号码界面 -->
        <div id="screen-probability" class="container mx-auto px-4 py-8 max-w-7xl hidden">
            <header class="mb-8">
                <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-neon-blue to-neon-red">
                    闲心快乐8工具2.0
                </h1>
                <p class="text-center text-gray-400 mt-2">概率号码分析</p>
            </header>

            <!-- 最新录入号码组显示区域 -->
            <section id="latest-number-groups-prob" class="mb-8">
                <div class="mb-4">
                    <!-- 桌面端布局 -->
                    <div class="hidden md:flex justify-between items-center mb-2">
                        <div class="flex items-center gap-3">
                            <h2 class="text-xl font-bold flex items-center">
                                <i class="fa fa-history mr-2 text-neon-blue"></i>
                                最新录入号码组
                            </h2>
                            <button id="refresh-data-prob" class="btn-primary bg-neon-red hover:bg-red-600 flex items-center transition-all duration-300 transform hover:scale-105 shadow-lg">
                                <i class="fa fa-refresh mr-2 fa-spin-hover"></i>刷新数据
                            </button>
                            <p class="text-xs text-gray-400">点击刷新开奖号码</p>
                        </div>
                        <div class="text-gray-400">
                            已存储: <span id="data-count-latest-prob">0</span> 个号码组
                        </div>
                    </div>
                    
                    <!-- 手机端布局 -->
                    <div class="md:hidden">
                        <div class="flex justify-between items-center mb-2">
                            <h2 class="text-xl font-bold flex items-center">
                                <i class="fa fa-history mr-2 text-neon-blue"></i>
                                最新录入号码组
                            </h2>
                            <div class="text-gray-400">
                                已存储: <span id="data-count-latest-mobile-prob">0</span> 个号码组
                            </div>
                        </div>
                        <div class="flex items-center gap-2 mb-1">
                            <button id="refresh-data-mobile-prob" class="btn-primary bg-neon-red flex items-center transition-all duration-300 transform hover:scale-105">
                                <i class="fa fa-refresh mr-2 fa-spin-hover"></i>刷新数据
                            </button>
                            <p class="text-xs text-gray-400">点击刷新开奖号码</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div id="latest-groups-container-prob" class="space-y-4">
                        <p class="text-gray-400 text-center py-6">暂无录入的号码组</p>
                    </div>
                </div>
            </section>

            <!-- 概率号码匹配功能 -->
            <section id="probability-match" class="mb-8">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fa fa-filter mr-2 text-neon-blue"></i>
                    概率号码匹配
                </h2>
                <div class="card">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-gray-300"><span id="selected-count-prob">0</span>/25 已选择</p>
                        <div class="flex items-center gap-2">
                            <div class="filter-period-buttons flex mr-2">
                                <button id="filter-all-prob" class="btn-secondary filter-btn active mr-1">全部期数</button>
                                <button id="filter-100-prob" class="btn-secondary filter-btn mr-1">100期以内</button>
                                <button id="filter-200-prob" class="btn-secondary filter-btn mr-1">200期以内</button>
                                <button id="filter-300-prob" class="btn-secondary filter-btn">300期以内</button>
                            </div>
                            <button id="clear-selection-prob" class="btn-danger flex items-center">
                                <i class="fa fa-times mr-2"></i>一键清除
                            </button>
                        </div>
                    </div>
                    
                    <!-- 号码选择器 -->
                    <div id="number-selector-prob" class="grid grid-cols-8 gap-3 mb-6">
                        <!-- 1-80号码将通过JS动态生成 -->
                    </div>
                    
                    <!-- 匹配选项按钮组 -->
                    <div class="mb-4 text-center">
                        <button id="start-probability-match" class="match-btn btn-primary py-3 px-6 text-base bg-neon-red hover:bg-red-600">
                            开始匹配概率号码
                        </button>
                    </div>
                    <style>
                        /* 缩小匹配结果表格内容 */
                        #results-container-prob table {
                            font-size: 10px !important;
                        }
                        #results-container-prob th,
                        #results-container-prob td {
                            padding: 2px !important;
                        }
                        /* 缩小匹配结果中的号码球 */
                        #results-container-prob .number-ball {
                            width: 16px !important;
                            height: 16px !important;
                            font-size: 7px !important;
                        }
                        /* 修复期数筛选按钮的active样式 */
                        .filter-btn.active {
                            background-color: #d32f2f;
                            color: white;
                        }
                        .filter-btn.active:hover {
                            background-color: rgba(211, 47, 47, 0.8);
                        }
                    </style>
                </div>
            </section>

            <!-- 概率号码匹配结果 -->
            <section id="probability-match-results" class="mb-8">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fa fa-bar-chart mr-2 text-neon-blue"></i>
                    概率号码匹配结果
                </h2>
                <div class="card">
                    <!-- 匹配结果显示区域 -->
                    <div id="probability-results-container" class="p-4">
                        <p class="text-gray-400 text-center py-6">请先选择号码并点击"开始匹配概率号码"按钮</p>
                    </div>
                </div>
            </section>
        </div>

        <!-- 3. 数据（仅后台）界面 -->
        <div id="screen-data" class="container mx-auto px-4 py-8 max-w-7xl hidden">
            <header class="mb-8">
                <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-neon-blue to-neon-red">
                    闲心快乐8工具2.0
                </h1>
                <p class="text-center text-gray-400 mt-2">数据管理（仅后台）</p>
            </header>

            <!-- 号码组导入功能 -->
            <section id="import-section" class="mb-8">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fa fa-upload mr-2 text-neon-blue"></i>
                    号码组导入
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- 单个导入 -->
                    <div class="card">
                        <h3 class="font-bold mb-3 text-neon-green">单个导入</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">编号</label>
                                <input type="text" id="single-id" class="input-dark w-full" placeholder="例如: 25289">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">号码组</label>
                                <input type="text" id="single-numbers" class="input-dark w-full" placeholder="例如: 03,06,07,10,11...">
                            </div>
                            <button id="import-single" class="btn-primary w-full transition-colors">导入</button>
                        </div>
                    </div>
                    
                    <!-- 批量导入 -->
                    <div class="card">
                        <h3 class="font-bold mb-3 text-neon-green">批量导入</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">批量输入</label>
                                <textarea id="batch-input" class="input-dark w-full h-32" placeholder="每行一个号码组，格式: 编号 号码1,号码2,号码3..."></textarea>
                            </div>
                            <button id="import-batch" class="btn-primary w-full transition-colors">批量导入</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 数据管理功能 -->
            <section id="data-management" class="mb-8">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fa fa-database mr-2 text-neon-blue"></i>
                    数据管理
                </h2>
                <div class="card">
                    <div class="flex flex-wrap gap-3">
                        <button id="download-updated-app" class="btn-primary flex items-center transition-colors">
                            <i class="fa fa-download mr-2"></i>下载号码组数据
                        </button>
                        <button id="clear-all-data" class="btn-danger flex items-center transition-colors">
                            <i class="fa fa-trash mr-2"></i>清空所有数据
                        </button>
                        <div class="ml-auto text-gray-400 self-center">
                            已存储: <span id="data-count">0</span> 个号码组
                        </div>
                    </div>
                </div>
            </section>

            <footer class="text-center text-gray-500 text-sm mt-12">
                <p>© 2025 号码组数据匹配工具 | 仅管理员可访问</p>
            </footer>
        </div>
    </div>

    <!-- 消息提示组件 -->
    <div id="toast" class="fixed bottom-4 right-4 bg-dark-accent border-l-4 border-neon-blue px-4 py-3 shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50">
        <div class="flex">
            <div class="mr-3">
                <i id="toast-icon" class="fa fa-check-circle text-neon-green"></i>
            </div>
            <div>
                <p id="toast-message" class="text-gray-200"></p>
            </div>
        </div>
    </div>

    <!-- 底部常驻导航栏 -->
    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 bg-dark-secondary border-t border-gray-700 z-50">
        <div class="grid grid-cols-3 h-16">
            <button id="nav-filter" class="nav-item active flex flex-col items-center justify-center transition-all">
                <i class="fa fa-filter text-xl text-neon-red mb-1"></i>
                <span class="text-sm">大底筛选</span>
            </button>
            <button id="nav-probability" class="nav-item flex flex-col items-center justify-center transition-all">
                <i class="fa fa-bar-chart text-xl text-gray-400 mb-1"></i>
                <span class="text-sm">概率号码</span>
            </button>
            <button id="nav-data" class="nav-item flex flex-col items-center justify-center transition-all">
                <i class="fa fa-database text-xl text-gray-400 mb-1"></i>
                <span class="text-sm">数据（仅后台）</span>
            </button>
        </div>
    </nav>

    <!-- 导航栏样式 -->
    <style>
        .nav-item {
            color: #d1d5db;
        }
        .nav-item.active {
            color: #d32f2f;
            background-color: rgba(211, 47, 47, 0.1);
        }
        .nav-item:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.05);
        }
        @media (max-width: 768px) {
            .nav-item span {
                font-size: 10px;
            }
            .nav-item i {
                font-size: 16px;
            }
        }
    </style>

    <script>
        // 导航切换功能
        document.addEventListener('DOMContentLoaded', function() {
            // 获取所有导航项和界面
            const navItems = document.querySelectorAll('.nav-item');
            const screens = [
                document.getElementById('screen-filter'),
                document.getElementById('screen-probability'),
                document.getElementById('screen-data')
            ];
            const navIds = ['nav-filter', 'nav-probability', 'nav-data'];
            
            // 导航切换函数
            function switchScreen(index) {
                // 隐藏所有界面
                screens.forEach(screen => {
                    screen.classList.add('hidden');
                });
                
                // 显示选中的界面
                screens[index].classList.remove('hidden');
                
                // 更新导航状态
                navItems.forEach((item, i) => {
                    item.classList.remove('active');
                    const icon = item.querySelector('i');
                    if (i === index) {
                        item.classList.add('active');
                        icon.classList.remove('text-gray-400');
                        icon.classList.add('text-neon-red');
                    } else {
                        icon.classList.remove('text-neon-red');
                        icon.classList.add('text-gray-400');
                    }
                });
            }
            
            // 为每个导航项添加点击事件
            navIds.forEach((navId, index) => {
                document.getElementById(navId).addEventListener('click', function() {
                    switchScreen(index);
                });
            });
            
            // 复制刷新数据功能到概率号码页面
            const refreshDataButtons = [
                document.getElementById('refresh-data'),
                document.getElementById('refresh-data-mobile'),
                document.getElementById('refresh-data-prob'),
                document.getElementById('refresh-data-mobile-prob')
            ];
            
            // 为概率页面的刷新按钮添加点击事件，触发原始刷新按钮的点击
            if (refreshDataButtons[2]) {
                refreshDataButtons[2].addEventListener('click', function() {
                    if (refreshDataButtons[0]) refreshDataButtons[0].click();
                });
            }
            
            if (refreshDataButtons[3]) {
                refreshDataButtons[3].addEventListener('click', function() {
                    if (refreshDataButtons[1]) refreshDataButtons[1].click();
                });
            }
            
            // 添加数据同步功能 - 确保两个页面的数据显示同步
            // 监听主页面数据变化并同步到概率页面
            function syncDataToProbability() {
                // 同步数据计数
                const mainCount = document.getElementById('data-count-latest');
                const probCount = document.getElementById('data-count-latest-prob');
                const mainMobileCount = document.getElementById('data-count-latest-mobile');
                const probMobileCount = document.getElementById('data-count-latest-mobile-prob');
                
                if (mainCount && probCount) {
                    probCount.textContent = mainCount.textContent;
                }
                if (mainMobileCount && probMobileCount) {
                    probMobileCount.textContent = mainMobileCount.textContent;
                }
                
                // 同步号码组内容
                const mainContainer = document.getElementById('latest-groups-container');
                const probContainer = document.getElementById('latest-groups-container-prob');
                
                if (mainContainer && probContainer && mainContainer.innerHTML.trim() !== '<p class="text-gray-400 text-center py-6">暂无录入的号码组</p>') {
                    probContainer.innerHTML = mainContainer.innerHTML;
                }
            }
            
            // 定期同步数据
            setInterval(syncDataToProbability, 1000);
            
            // 为概率号码页面的期数筛选按钮添加事件监听
            document.querySelectorAll('#filter-all-prob, #filter-100-prob, #filter-200-prob, #filter-300-prob').forEach(btn => {
                btn.addEventListener('click', function() {
                    // 移除所有按钮的active状态
                    document.querySelectorAll('#filter-all-prob, #filter-100-prob, #filter-200-prob, #filter-300-prob').forEach(b => {
                        b.classList.remove('active');
                    });
                    // 添加当前按钮的active状态
                    this.classList.add('active');
                });
            });
            
            // 为概率号码页面的一键清除按钮添加事件监听
            document.getElementById('clear-selection-prob')?.addEventListener('click', function() {
                // 清除所有已选择的号码
                document.querySelectorAll('#number-selector-prob .selected').forEach(ball => {
                    ball.classList.remove('selected');
                    ball.style.backgroundColor = '#1f2937'; // 恢复默认背景色
                });
                // 更新已选择数量
                document.getElementById('selected-count-prob').textContent = '0';
                
                // 清除匹配结果
                const resultsContainer = document.getElementById('probability-results-container');
                if (resultsContainer) {
                    resultsContainer.innerHTML = '<p class="text-gray-400 text-center py-6">请先选择号码并点击"开始匹配概率号码"按钮</p>';
                }
            });
            
            // 为概率号码页面的开始匹配按钮添加事件监听
            document.getElementById('start-probability-match')?.addEventListener('click', function() {
                // 获取选中的号码
                const selectedNumberElements = document.querySelectorAll('#number-selector-prob .selected');
                const selectedNumbers = Array.from(selectedNumberElements).map(el => parseInt(el.dataset.number));
                
                // 验证选中的号码数量
                if (selectedNumbers.length === 0) {
                    showToast('请至少选择一个号码进行匹配', 'warning');
                    return;
                }
                
                // 获取当前筛选期数
                const activeFilterButton = document.querySelector('#probability-match .filter-btn.active');
                let filterPeriod = 0;
                if (activeFilterButton) {
                    if (activeFilterButton.id === 'filter-100-prob') filterPeriod = 100;
                    else if (activeFilterButton.id === 'filter-200-prob') filterPeriod = 200;
                    else if (activeFilterButton.id === 'filter-300-prob') filterPeriod = 300;
                }
                
                // 执行概率号码匹配
                performProbabilityNumberMatch(selectedNumbers, filterPeriod);
            });
            
            // 执行概率号码匹配
            function performProbabilityNumberMatch(selectedNumbers, filterPeriod) {
                // 获取号码组数据（从NumberMatcherApp获取）
                const allNumberGroups = NumberMatcherApp.state.numberGroups;
                
                if (allNumberGroups.length === 0) {
                    showToast('数据库中暂无号码组数据', 'warning');
                    return;
                }
                
                // 计算数据库中最大编号
                let maxGroupId = 0;
                allNumberGroups.forEach(group => {
                    const idNum = parseInt(group.id);
                    if (!isNaN(idNum) && idNum > maxGroupId) {
                        maxGroupId = idNum;
                    }
                });
                
                // 根据筛选期数过滤号码组
                let filteredGroups = allNumberGroups;
                if (filterPeriod > 0) {
                    // 计算最大连续编号
                    const maxIndex = Math.max(...allNumberGroups.map(group => {
                        return group.index || 0;
                    }));
                    
                    // 筛选出最新的filterPeriod期号码组，使用连续编号（index）来筛选
                    const minIndex = maxIndex - filterPeriod + 1;
                    filteredGroups = allNumberGroups.filter(group => {
                        return group.index >= minIndex && group.index <= maxIndex;
                    });
                }
                
                // 执行完整匹配
                const fullMatchResults = findProbabilityNumbers(selectedNumbers, filteredGroups, false);
                
                // 执行降位匹配
                const reducedMatchResults = findReducedProbabilityNumbers(selectedNumbers, filteredGroups);
                
                // 渲染结果
                renderProbabilityMatchResults(selectedNumbers, fullMatchResults, reducedMatchResults);
            }
            
            // 查找概率号码
            function findProbabilityNumbers(selectedNumbers, numberGroups, reduced = false) {
                // 统计其他号码的出现次数
                const numberOccurrences = {};
                const lastAppearance = {};
                const lastAppearanceIndex = {};
                
                // 找到最新一期号码组的连续编号
                let latestGroupIndex = 0;
                let maxGroupId = 0;
                numberGroups.forEach(group => {
                    const idNum = parseInt(group.id);
                    if (!isNaN(idNum) && idNum > maxGroupId) {
                        maxGroupId = idNum;
                        latestGroupIndex = group.index;
                    }
                });
                
                // 遍历所有号码组
                numberGroups.forEach(group => {
                    const groupNumbers = group.numbers;
                    const groupId = parseInt(group.id) || 0;
                    
                    // 检查当前组是否包含所有选中的号码（确保类型匹配）
                    const containsAllSelected = selectedNumbers.every(num => {
                        return groupNumbers.includes(num.toString()) || groupNumbers.includes(num);
                    });
                    
                    if (containsAllSelected) {
                        // 统计该组中其他号码的出现次数
                        groupNumbers.forEach(numItem => {
                            // 确保num是数字类型，无论原始数据是什么类型
                            const num = typeof numItem === 'number' ? numItem : parseInt(numItem);
                            // 跳过选中的号码
                            if (!selectedNumbers.includes(num)) {
                                numberOccurrences[num] = (numberOccurrences[num] || 0) + 1;
                                // 更新最后出现期数和对应的连续编号
                                if (!lastAppearance[num] || groupId > lastAppearance[num]) {
                                    lastAppearance[num] = groupId;
                                    lastAppearanceIndex[num] = group.index;
                                }
                            }
                        });
                    }
                });
                
                // 转换为数组并计算遗漏期数
                const results = Object.keys(numberOccurrences).map(num => {
                    const lastMatchGroupId = lastAppearance[num];
                    const lastMatchIndex = lastAppearanceIndex[num] || 0;
                    // 计算遗漏期数 = 最新一期连续编号 - 最后匹配的连续编号
                    const missCount = latestGroupIndex > 0 ? latestGroupIndex - lastMatchIndex : 0;
                    
                    return {
                        number: parseInt(num),
                        occurrences: numberOccurrences[num],
                        lastAppearance: lastMatchGroupId,
                        missCount: missCount
                    };
                });
                
                // 按出现次数降序排序，如果出现次数相同，则按号码大小升序排序
                results.sort((a, b) => {
                    if (b.occurrences !== a.occurrences) {
                        return b.occurrences - a.occurrences;
                    }
                    return a.number - b.number;
                });
                
                // 只保留前10个结果
                return results.slice(0, 10);
            }
            
            // 查找降位匹配的概率号码
            function findReducedProbabilityNumbers(selectedNumbers, numberGroups) {
                const reducedResults = [];
                
                // 对于每个选中的号码，创建一个移除该号码的新数组（最多只移除一位号码）
                for (let i = 0; i < selectedNumbers.length; i++) {
                    const reducedNumbers = [...selectedNumbers];
                    reducedNumbers.splice(i, 1);
                    
                    // 当降位匹配之后只有一个号码时，不进行降位匹配
                    if (reducedNumbers.length <= 1) {
                        continue;
                    }
                    
                    // 执行降位匹配
                    const results = findProbabilityNumbers(reducedNumbers, numberGroups, true);
                    
                    if (results.length > 0) {
                        reducedResults.push({
                            matchNumbers: reducedNumbers, // 存储完整的匹配号码
                            results: results
                        });
                    }
                }
                
                // 按结果质量排序（基于第一个结果的出现次数）
                reducedResults.sort((a, b) => {
                    const aFirstOccurrence = a.results[0]?.occurrences || 0;
                    const bFirstOccurrence = b.results[0]?.occurrences || 0;
                    return bFirstOccurrence - aFirstOccurrence;
                });
                
                // 只保留前5组降位匹配结果
                return reducedResults.slice(0, 5);
            }
            
            // 渲染概率匹配结果
            function renderProbabilityMatchResults(selectedNumbers, fullMatchResults, reducedMatchResults) {
                const container = document.getElementById('probability-results-container');
                
                if (fullMatchResults.length === 0 && reducedMatchResults.length === 0) {
                    container.innerHTML = '<p class="text-gray-400 text-center py-6">没有找到匹配的号码</p>';
                    return;
                }
                
                let html = '';
                
                // 渲染完整匹配结果
                if (fullMatchResults.length > 0) {
                    html += `
                    <div class="mb-6">
                        <h3 class="text-xl font-bold mb-3 flex items-center">
                            <i class="fa fa-check-circle text-neon-green mr-2"></i>
                            完整匹配号码 ${selectedNumbers.sort((a, b) => a - b).map(num => `<span class="inline-block w-8 h-8 rounded-full bg-red-600 flex items-center justify-center text-white mx-2" style="box-shadow: 0 0 10px rgba(220, 38, 38, 0.8);">${num.toString().padStart(2, '0')}</span>`).join('')}
                        </h3>
                        <div class="overflow-x-auto">
                            <table class="border-collapse w-full">
                                <!-- 第一行：概率号码 -->
                                <tr>
                                    <td class="border border-gray-700 p-2 text-center font-bold min-w-[100px]">概率号码</td>
                                    ${fullMatchResults.slice(0, 10).map((result, index) => {
                                        let bgClass = 'bg-blue-300'; // 默认淡蓝色球
                                        if (index < 3) {
                                            bgClass = 'bg-red-600'; // 前三位改为红色
                                        }
                                        return `
                                        <td class="border border-gray-700 p-2 text-center min-w-[80px]">
                                            <div class="w-8 h-8 rounded-full ${bgClass} flex items-center justify-center text-white font-bold mx-auto">
                                                ${result.number.toString().padStart(2, '0')}
                                            </div>
                                        </td>
                                        `;
                                    }).join('')}
                                </tr>
                                <!-- 第二行：出现次数 -->
                                <tr>
                                    <td class="border border-gray-700 p-2 text-center font-bold min-w-[100px]">出现次数</td>
                                    ${fullMatchResults.slice(0, 10).map(result => `
                                    <td class="border border-gray-700 p-2 text-center font-bold text-white min-w-[80px]">
                                        ${result.occurrences}次
                                    </td>
                                    `).join('')}
                                </tr>
                                <!-- 第三行：遗漏期数 -->
                                <tr>
                                    <td class="border border-gray-700 p-2 text-center font-bold min-w-[100px]">遗漏期数</td>
                                    ${fullMatchResults.slice(0, 10).map(result => `
                                    <td class="border border-gray-700 p-2 text-center font-bold min-w-[80px]">
                                        ${result.missCount}期
                                    </td>
                                    `).join('')}
                                </tr>
                                <!-- 第四行：最后期数 -->
                                <tr>
                                    <td class="border border-gray-700 p-2 text-center font-bold min-w-[100px]">最后期数</td>
                                    ${fullMatchResults.slice(0, 10).map(result => `
                                    <td class="border border-gray-700 p-2 text-center min-w-[80px]" style="font-size: 0.875rem;">
                                        ${result.lastAppearance}期
                                    </td>
                                    `).join('')}
                                </tr>
                            </table>
                        </div>
                        <div class="text-center mt-3">
                            <button class="full-match-copy-btn px-4 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">
                                <i class="fa fa-copy mr-1"></i> 复制概率号码
                            </button>
                        </div>
                    </div>
                    `;
                }
                
                // 渲染降位匹配结果
                if (reducedMatchResults.length > 0) {
                    html += `
                    <div class="mb-6">
                        <h3 class="text-lg font-bold mb-3 flex items-center">
                            <i class="fa fa-minus-circle text-neon-yellow mr-2"></i>
                            降位匹配结果
                        </h3>
                    `;
                    
                    reducedMatchResults.forEach((reducedMatch, index) => {
                        html += `
                        <div class="mb-4 p-3 bg-dark-accent rounded-lg">
                            <p class="text-lg font-bold mb-2 flex items-center">降位组合 ${index + 1}：${reducedMatch.matchNumbers.sort((a, b) => a - b).map(num => `<span class="inline-block w-8 h-8 rounded-full bg-red-600 flex items-center justify-center text-white mx-2" style="box-shadow: 0 0 10px rgba(220, 38, 38, 0.8);">${num.toString().padStart(2, '0')}</span>`).join('')}</p>
                            <div class="overflow-x-auto">
                                <table class="border-collapse w-full">
                                    <!-- 第一行：概率号码 -->
                                    <tr>
                                        <td class="border border-gray-700 p-2 text-center font-bold min-w-[100px]">概率号码</td>
                                        ${reducedMatch.results.slice(0, 10).map((result, idx) => {
                                            let bgClass = 'bg-blue-300'; // 默认淡蓝色球
                                            if (idx < 3) {
                                                bgClass = 'bg-red-600'; // 前三位改为红色
                                            }
                                            return `
                                            <td class="border border-gray-700 p-2 text-center">
                                                <div class="w-8 h-8 rounded-full ${bgClass} flex items-center justify-center text-white font-bold mx-auto">
                                                    ${result.number.toString().padStart(2, '0')}
                                                </div>
                                            </td>
                                            `;
                                        }).join('')}
                                    </tr>
                                    <!-- 第二行：出现次数 -->
                                    <tr>
                                        <td class="border border-gray-700 p-2 text-center font-bold min-w-[100px]">出现次数</td>
                                        ${reducedMatch.results.slice(0, 10).map(result => `
                                        <td class="border border-gray-700 p-2 text-center font-bold text-white min-w-[80px]">
                                            ${result.occurrences}次
                                        </td>
                                        `).join('')}
                                    </tr>
                                    <!-- 第三行：遗漏期数 -->
                                    <tr>
                                        <td class="border border-gray-700 p-2 text-center font-bold min-w-[100px]">遗漏期数</td>
                                        ${reducedMatch.results.slice(0, 10).map(result => `
                                        <td class="border border-gray-700 p-2 text-center font-bold min-w-[80px]">
                                            ${result.missCount}期
                                        </td>
                                        `).join('')}
                                    </tr>
                                    <!-- 第四行：最后期数 -->
                                    <tr>
                                        <td class="border border-gray-700 p-2 text-center font-bold min-w-[100px]">最后期数</td>
                                        ${reducedMatch.results.slice(0, 10).map(result => `
                                        <td class="border border-gray-700 p-2 text-center min-w-[80px]" style="font-size: 0.875rem;">
                                            ${result.lastAppearance}期
                                        </td>
                                        `).join('')}
                                    </tr>
                                </table>
                            </div>
                        </div>
                        `;
                    });
                    
                    html += `</div>`;
                }
                
                container.innerHTML = html;
                
                // 为完整匹配结果添加复制功能
                fullMatchResults.length > 0 && document.querySelectorAll('.full-match-copy-btn').forEach(btn => {
                    btn.onclick = function() {
                        const numbers = fullMatchResults.slice(0, 10).map(r => r.number.toString().padStart(2, '0')).join(',');
                        navigator.clipboard.writeText(numbers).then(() => {
                            alert('概率号码已复制到剪贴板');
                        });
                    };
                });
                
                // 为每个降位匹配结果添加复制按钮
                reducedMatchResults.forEach((reducedMatch, idx) => {
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'mx-auto block mt-3 px-4 py-1 bg-blue-600 text-white rounded hover:bg-blue-700';
                    copyBtn.innerHTML = '<i class="fa fa-copy mr-1"></i> 复制概率号码';
                    copyBtn.onclick = function() {
                        const numbers = reducedMatch.results.slice(0, 10).map(r => r.number.toString().padStart(2, '0')).join(',');
                        navigator.clipboard.writeText(numbers).then(() => {
                            alert('概率号码已复制到剪贴板');
                        });
                    };
                    // 找到对应的降位匹配div并添加按钮
                    const divs = document.querySelectorAll('.mb-4.p-3.bg-dark-accent.rounded-lg');
                    if (divs[idx]) {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'text-center';
                        wrapper.appendChild(copyBtn);
                        divs[idx].appendChild(wrapper);
                    }
                });
            }
            
            // 动态生成概率号码页面的号码选择器
            function generateProbabilityNumberSelector() {
                const container = document.getElementById('number-selector-prob');
                if (!container) return;
                
                container.innerHTML = '';
                for (let i = 1; i <= 80; i++) {
                    const numberBall = document.createElement('button');
                    numberBall.className = 'number-ball w-10 h-10 rounded-full bg-dark-accent flex items-center justify-center text-white border border-gray-700 transition-all duration-200 hover:bg-gray-700';
                    numberBall.textContent = i.toString().padStart(2, '0');
                    numberBall.dataset.number = i;
                    
                    numberBall.addEventListener('click', function() {
                        // 修复号码选择高亮效果，与大底筛选模块保持一致
                        if (this.classList.contains('selected')) {
                            // 取消选中
                            this.classList.remove('selected');
                            this.style.backgroundColor = '#1f2937'; // 恢复默认背景色
                        } else {
                            // 选中号码
                            this.classList.add('selected');
                            this.style.backgroundColor = '#f43f5e'; // 设置选中背景色为neon-red
                        }
                        
                        // 更新已选择数量
                        const selectedCount = document.querySelectorAll('#number-selector-prob .selected').length;
                        document.getElementById('selected-count-prob').textContent = selectedCount.toString();
                    });
                    
                    container.appendChild(numberBall);
                }
            }
            
            // 页面加载时生成号码选择器
            window.addEventListener('load', generateProbabilityNumberSelector);
        });
    </script>

    <script src="app.js"></script>
</body>
</html>
